<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="utf-8">
	<title>Test</title>
	<link rel="stylesheet" href="style.css">
	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script>
		
		function breedteSchip(schip) {
			var breedte;
			
			switch(schip.afmeting) {
				case 2:
					breedte = "144px";
					break;
				case 3:
					breedte = "216px";
					break;
				case 4:
					breedte = "288px";
					break;
				case 5:
					breedte = "360px";
					break;
				case 6:
					breedte = "432px";
					break;
				case 7:
					breedte = "503px";
					break;
			}
			return breedte;
		}
		
		
		var socket = io();
	  
		socket.on('getSchepen', function (msg) {
			for(var i = 0; i < msg[1].height; i++){
				$( "#bord" ).append( "<div id='row" + i + "' class='rowstyle'>" );
				for(var j = 0; j < msg[1].width; j++) {
					var name = "#row" + i;
					$( name ).append( "<div class='x" + j + " drop-target'><div></div></div>" );
				}
				$( "#bord" ).append( "</div>" );
			}
			var schepen = [];
			var aantal = [];
			var grootte = 0;
			for(var i = 0; i < msg[0].length; i++)
			{
				if(schepen.indexOf(msg[0][i].naam) == -1)
				{
					$( "#inputfields" ).append("<input type='radio' id='" + msg[0][i].naam + "' class='kiesboot' name='schip' value='" + msg[0][i].naam + "'/><label for='" + msg[0][i].naam + "'>" + msg[0][i].naam + "</label><br />");
					schepen.push(msg[0][i].naam);
					aantal[schepen.indexOf(msg[0][i].naam)] = 1;
				}
				else
				{
					aantal[schepen.indexOf(msg[0][i].naam)] += 1;
				}
			}
			
			for(var i = 0; i < aantal.length; i++)
			{
				var idnaam = "label[for= " + schepen[i] + "]";
				$( idnaam ).append("<span class='aantalschepen'> " + aantal[i] + "x</span>" );
			}
			
			function plaatsschip(object, kleur, richting, reverse, schipset) {
				if(richting == 'horizontaal') { 
					
					if ($( object ).parent().attr('data-schip-set') === undefined) {
						if (reverse != true) {
							$( object ).width(0);
					  		$( object ).height(0);
					  		$( object ).css('border', '26px solid transparent'); 
					  	}
					  	else
					  	{
						  	$( object ).width("100%");
					  		$( object ).height("100%");
					  		$( object ).css('border', 'none'); 
					  	}
					  	$( object ).css("border-right-color", kleur);
					}
				  	if(schipset == true)
				  	{
				  		$( object ).parent().attr("data-schip-set", "gezet");
				  	}
				  	var x = $( object ).parent().attr('class').split('x')[1].split(' ')[0];
				  	for(var i = 1; i < grootte; i++)
				  	{
					  	if(i != (grootte - 1)) {
						  	if ($( object ).parent().parent().children( (".x" + (parseInt(x) + i)) ).attr('data-schip-set') === undefined) {
							  	$( object ).parent().parent().children( (".x" + (parseInt(x) + i)) ).css("background-color",kleur);
							  	if(schipset == true)
							  	{
							  		$( object ).parent().parent().children( (".x" + (parseInt(x) + i)) ).attr("data-schip-set", "gezet");
							  	}
							}
						}
				  	}
				  	var einde = $( object ).parent().parent().children((".x" + (parseInt(x) + (grootte - 1)))).children();
					if (einde.parent().attr('data-schip-set') === undefined) {
						if (reverse != true) {
							einde.width(0);
					  		einde.height(0);
					  		einde.css('border', '26px solid transparent'); 
					  	}
					  	else
					  	{
						  	einde.width("100%");
						  	einde.height("100%");
						  	einde.css('border', 'none'); 
					  	}
					  	if (schipset == true)
					  	{
						  	einde.parent().attr("data-schip-set", "gezet");
					  	}
					  	einde.css("border-left-color", kleur);
					}
				  	
				  	
				}
				else if (richting == 'verticaal') {
					if ($( object ).parent().attr('data-schip-set') === undefined) {
						if (reverse != true) {
							$( object ).width(0);
					  		$( object ).height(0);
					  		$( object ).css('border', '26px solid transparent'); 
					  	}
					  	else
					  	{
						  	$( object ).width("100%");
					  		$( object ).height("100%");
					  		$( object ).css('border', 'none'); 
					  	}
					  	$( object ).css("border-bottom-color", kleur);
					  	
					}
					if(schipset == true)
				  	{
				  		$( object ).parent().attr("data-schip-set", "gezet");
				  	}
				  	var x = $( object ).parent().attr('class').split('x')[1].split(' ')[0];
				  	var y = $( object ).parent().parent().attr('id').split('row')[1];
				  	for(var i = 1; i < grootte; i++)
					{
						
						if(i != (grootte - 1)) {
							if ($( ("#row" + (parseInt(y) + i) ) ).children( (".x" + parseInt(x)) ).attr('data-schip-set') === undefined) {
								$( ("#row" + (parseInt(y) + i) ) ).children( (".x" + parseInt(x)) ).css("background-color",kleur);
							}
							if(schipset == true)
						  	{
						  		$( ("#row" + (parseInt(y) + i) ) ).children( (".x" + parseInt(x)) ).attr("data-schip-set", "gezet");
						  	}	
						}
					}
					var einde = $( ("#row" + (parseInt(y) + (grootte - 1)) ) ).children((".x" + parseInt(x))).children();
					if ( einde.parent().attr('data-schip-set') === undefined) {
						if (reverse != true) {
							einde.width(0);
					  		einde.height(0);
					  		einde.css('border', '26px solid transparent'); 
					  	}
					  	else
					  	{
						  	einde.width("100%");
						  	einde.height("100%");
						  	einde.css('border', 'none'); 
					  	}
					  	if (schipset == true)
					  	{
						  	einde.parent().attr("data-schip-set", "gezet");
					  	}
					  	einde.css("border-top-color", kleur);
					}
					
				}

			}
			
			$( ".drop-target > div" ).hover(function() {
			  	if(grootte != 0)
			  	{
				  	if($('#horizontaal').is(':checked')) { 
						plaatsschip(this, "#757575", "horizontaal");
					}
					else if($('#verticaal').is(':checked')) { 
						plaatsschip(this, "#757575", "verticaal");
				  	}
					
			  	}
			}, function() {
				if(grootte != 0)
			  	{
					if($('#horizontaal').is(':checked')) { 
						plaatsschip(this, "transparant", "horizontaal", true);
					}
					else if($('#verticaal').is(':checked')) { 
						plaatsschip(this, "transparant", "verticaal", true);
				  	}
			  	}
			});
			
			$('.drop-target > div').click(function() {
				var schip = $('input[name=schip]:checked', '#inputfields').val();
				var richting = $('input[name=richting]:checked', '#richting').val();
				$( this ).attr("data-schip", schip);
				$( this ).attr("data-schip-richting", richting);
				plaatsschip(this, "#23ae6b", richting, false, true);
				var arrayid = schepen.indexOf(schip);
				aantal[arrayid] -= 1;
				var idnaam = "label[for= " + schip + "] > span.aantalschepen";
				$( idnaam ).text( " " + aantal[arrayid] + "x" );
				if(aantal[arrayid] == 0)
				{
					$( ("#" + schip) ).prop('checked', false);
					grootte = 0;
				}
			});
			
			$('.kiesboot').click(function() {
				var arrayid = schepen.indexOf($( this ).attr('id'));
				var afmeting = 0;
				if(aantal[arrayid] > 0)
				{
					for(var i = 0; i < msg[0].length; i++) {
						if(msg[0][i].naam == $( this ).attr('id'))
						{
							afmeting = msg[0][i].afmeting;
							break;
						}
					}
					//aantal[arrayid] -= 1;  VOOR HET WEGHALEN
				}
				else
				{
					$(this).prop('checked', false);
				}
				if(afmeting == 0)
				{
					console.log("Error met de afmeting");
				}
				else
				{
					grootte = afmeting;
				}
			});
			
			/*
			for(var i = 0; i < msg[0].length; i++) {
				$( "#schepen" ).append( "<div class='pep " + msg[0][i].naam + "' style= 'width: " + breedteSchip(msg[0][i]) + "'></div>" );
			}
			*/
			$( "#bord" ).slideDown( "slow" );
			$( "#schepen" ).slideDown( "slow" );
			
			/*$( ".pep" ).dblclick(function() {
				var width = $( this ).width();
				var height = $( this ).height();
				
				$( this ).width(height);
				$( this ).height(width);
			});*/
			
			console.log(msg);
			var testdata = msg[0];
			var slagschepen = 0,
				onderzeeer = 0,
				torpedobootjager = 0,
				patrouilleschip = 0;
			for(var i = 0; i < testdata.length; i++)
			{
				if(testdata[i].naam == 'vliegdekschip')
				{
					testdata[i].x = 4;
					testdata[i].y = 9;
					testdata[i].position = 'horizontaal';
				}
				else if(testdata[i].naam == 'slagschip' && slagschepen == 0)
				{
					testdata[i].x = 6;
					testdata[i].y = 0;
					testdata[i].position = 'horizontaal';
					slagschepen = 1;
				}
				else if(testdata[i].naam == 'slagschip' && slagschepen == 1)
				{
					testdata[i].x = 0;
					testdata[i].y = 2;
					testdata[i].position = 'verticaal';
					slagschepen = 2;
				}
				else if(testdata[i].naam == 'onderzeeer' && onderzeeer == 0)
				{
					testdata[i].x = 3;
					testdata[i].y = 0;
					testdata[i].position = 'verticaal';
					onderzeeer = 1;
				}
				else if(testdata[i].naam == 'onderzeeer' && onderzeeer == 1)
				{
					testdata[i].x = 5;
					testdata[i].y = 2;
					testdata[i].position = 'horizontaal';
					onderzeeer = 2;
				}
				else if(testdata[i].naam == 'onderzeeer' && onderzeeer == 2)
				{
					testdata[i].x = 9;
					testdata[i].y = 5;
					testdata[i].position = 'verticaal';
					onderzeeer = 3;
				}
				else if(testdata[i].naam == 'torpedobootjager' && torpedobootjager == 0)
				{
					testdata[i].x = 2;
					testdata[i].y = 4;
					testdata[i].position = 'horizontaal';
					torpedobootjager = 1;
				}
				else if(testdata[i].naam == 'torpedobootjager' && torpedobootjager == 1)
				{
					testdata[i].x = 3;
					testdata[i].y = 6;
					testdata[i].position = 'verticaal';
					torpedobootjager = 2;
				}
				else if(testdata[i].naam == 'torpedobootjager' && torpedobootjager == 2)
				{
					testdata[i].x = 0;
					testdata[i].y = 9;
					testdata[i].position = 'horizontaal';
					torpedobootjager = 3;
				}
				else if(testdata[i].naam == 'patrouilleschip' && patrouilleschip == 0)
				{
					testdata[i].x = 0;
					testdata[i].y = 0;
					testdata[i].position = 'horizontaal';
					patrouilleschip = 1;
				}
				else if(testdata[i].naam == 'patrouilleschip' && patrouilleschip == 1)
				{
					testdata[i].x = 9;
					testdata[i].y = 2;
					testdata[i].position = 'verticaal';
					patrouilleschip = 2;
				}
				else if(testdata[i].naam == 'patrouilleschip' && patrouilleschip == 2)
				{
					testdata[i].x = 5;
					testdata[i].y = 5;
					testdata[i].position = 'verticaal';
					patrouilleschip = 3;
				}
				else if(testdata[i].naam == 'patrouilleschip' && patrouilleschip == 3)
				{
					testdata[i].x = 0;
					testdata[i].y = 7;
					testdata[i].position = 'horizontaal';
					patrouilleschip = 4;
				}
				
			}
			console.log(testdata);
			socket.emit('setSchepen', testdata);
		});
		
		socket.on('turn', function (msg) {
			console.log("Aan de beurt yeah!:" + msg);
			
			socket.emit('setShoot', [3, 4]);
		});
		
		socket.on('wait', function () {
			console.log("Even wachten hoor guys!");
		});
		
	</script>
</head>
<body>
	<div class="clearfix">
		<div id="bord" class="demo droppable floatleft" style="display: none;">
		</div>
		<div id="schepen" class="floatright relative" style="display: none;">
			<form id="inputfields">
			</form>
			<form id="richting">
				<br /><br /><input type='radio' id='horizontaal' name='richting' value='horizontaal' checked /><label for='horizontaal'>horizontaal</label><br />
				<input type='radio' id='verticaal' name='richting' value='verticaal'/><label for='verticaal'>verticaal</label>
			</form>
		</div>
	</div>
</body>
</html>